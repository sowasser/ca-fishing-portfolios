---
title: "Annual trends in California fisheries from 1992-2014"
author: "Sophia Wassermann"
date: "3/1/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Data source

These data were downloaded from the [California Department of Natural Resources, Characterization of Human Uses and the Socioenonomic Dimensions, California North Coast MPA Baseline Study, 1992 to 2014][1].


## Overall timeseries
Aggregated across all ports, the timeseries for the number of fishers, total revenue, and pounds landed from 1992-2014 shows a general declining trend in fishers and pounds landed. Revenue is highly variable over the timeseries, with a large increase in 2012 and 2014.

```{r, include=FALSE}
# Code for a summary of the timeseries data for all of CA, pulled from all_ca_summary.R
library(reshape2)
library(ggplot2)

ca_summary <- read.csv("Data/ca_summary_92-14.csv")

# Overall trends across timeseries --------------------------------------------
summary_long <- melt(ca_summary, id="year")  # convert to long form for faceted graph
summary_long$year <- as.numeric(summary_long$year)

# Create list to use as year labels in graph
years <- c("92", "93", "94", "95", "96", "97", "98", "99", "00", "01", "02", 
           "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14")

summary_plot <- ggplot(summary_long, aes(x = year, y = value)) + 
  theme_bw() +
  geom_line(size = 1) +  
  ylab(" ") + 
  scale_x_continuous(labels=years, breaks=ca_summary$year) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  facet_wrap(~variable, scale="free", ncol = 1)
```

```{r summary_plot, fig.width = 4.5, fig.height = 5.5, fig.align = "center", echo=FALSE}
summary_plot
```

## Timeseries by port
There is high variability in the amount of revenue collected for each port in the dataset, with the same increase towards the end of the timeseries (as seen in the general data above) for a few ports, namely the Bodega Bay Area Ports, Monterey Area Ports, the Princeton-Half Moon Area Ports, and the Ventura ports.

```{r, include=FALSE}
# Code for total revenue per port graph, from CA_port_landings.R
library(dplyr)
library(tidyr)
library(reshape2)
library(ggplot2)

# Read in all landings data
port_landings <- read.csv("Data/port_landings_updated.csv")

pl <- port_landings %>% drop_na()  # remove NAs
pl <- pl[order(pl$year, pl$port, -pl$ex.vessel_revenue), ]  # order by revenue

# Total revenue per port per year
pl_revenue <- group_by(pl, year, port) %>% summarize(revenue = sum(ex.vessel_revenue))
pl_revenue <- pl_revenue %>% filter(port != "OTHER CA PORTS")  # remove empty port category

total_revenue <- ggplot(pl_revenue, aes(x = year, y = revenue)) + 
  theme_bw() +
  geom_line(size=1) +  
  ylab("overall revenue") + xlab(" ") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  facet_wrap(~port, ncol = 5)
```

```{r total_revenue, fig.width = 12, fig.height = 12, fig.align = "center", echo=FALSE}
total_revenue
```

\newpage

The number of fisheries engaged in by port shows a much more consistent, downward trend, or a relatively flat trend. Each fishery here is defined as a species and gear combination.

```{r, include=FALSE}
# Code for numer of fisheries per port graph, from CA_port_landings.R
library(dplyr)
library(tidyr)
library(reshape2)
library(ggplot2)

# Read in all landings data
port_landings <- read.csv("Data/port_landings_updated.csv")

pl_fishgear <- pl %>% unite(fishgear, fishery, gear, sep = " - ")
pl_fishgear$fishgear <- as.factor(pl_fishgear$fishgear)
pl_fishgear <- pl_fishgear %>% filter(port != "OTHER CA PORTS")

pl_count <- count(pl_fishgear, year, port)

fisheries_number <- ggplot(pl_count, aes(x = year, y = n)) + 
  theme_bw() +
  geom_line(size=1) +  
  ylab("number of fisheries") + xlab(" ") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  facet_wrap(~port, ncol = 5)
```


```{r fisheries_number, fig.width = 12, fig.height = 12, fig.align = "center", echo=FALSE}
fisheries_number
```

\newpage

## Timeseries by fishery species
The timeseries of revenue for each species (here all gear types combined) demonstrate both what are the most revenue-producing species (dungeness crab, lobster, squid, red urchin, salmon) and the general trends in each species from 1992-2014. Notably, there has not been a significant fishery for species such as herring roe since the late 1990s, along with a large decline in red urchin around the same period. Market squid, on the other hand, has increased over the timeseries, as has dungeness crab, though revenue is highly variable. 

```{r, include=FALSE}
# Code for plot of revenue by fisheries species, from species_revenue.R
library(dplyr)
library(reshape2)
library(ggplot2)

port_landings <- read.csv("Data/port_landings_updated.csv")

fish_sums <- group_by(port_landings, year, port, fishery) %>% 
  summarize(revenue = sum(ex.vessel_revenue))
fish_sums <- fish_sums %>% drop_na()
fish_sums2 <-  group_by(fish_sums, year, fishery) %>% 
  summarize(revenue = sum(revenue))

fish_revenue_sum <- ggplot(fish_sums2, aes(x = year, y = revenue)) +
  theme_bw() +
  geom_line(size=1) +  
  ylab("revenue") + xlab(" ") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  facet_wrap(~fishery, ncol = 6)
```

```{r fish_revenue_sum, fig.width = 12, fig.height = 10, fig.align = "center", echo=FALSE}
fish_revenue_sum
```

[1]: https://data.cnra.ca.gov/dataset/human-uses-and-socioeconomic-dimensions-ca-north-coast-mpa-baseline-study-1992-2014
